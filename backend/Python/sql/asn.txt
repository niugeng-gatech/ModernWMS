CREATE TABLE [dbo].[new_asn] (
    id INT IDENTITY(1,1) PRIMARY KEY,
    asn_no NVARCHAR(MAX) NOT NULL,
    asn_status INTEGER NOT NULL,
    spu_id INT NOT NULL,
    sku_id INT NOT NULL,
    asn_qty INT NOT NULL,
    actual_qty INT NOT NULL,
    sorted_qty INT NOT NULL,
    shortage_qty INT NOT NULL,
    more_qty INT NOT NULL,
    damage_qty INT NOT NULL,
    weight decimal NOT NULL,
    volume decimal NOT NULL,
    supplier_id INT NOT NULL,
    supplier_name NVARCHAR(MAX) NOT NULL,
    goods_owner_id INT NOT NULL,
    goods_owner_name NVARCHAR(MAX) NOT NULL,
    creator NVARCHAR(MAX) NOT NULL,
    create_time datetime2 DEFAULT GETDATE(),
    last_update_time datetime2 DEFAULT GETDATE(),
    is_valid bit NOT NULL,
    tenant_id bigint NOT NULL,
    asnmaster_id INT NOT NULL, 
    arrival_time datetime2 DEFAULT GETDATE(), 
    unload_time datetime2 DEFAULT GETDATE(), 
    unload_person_id INT NOT NULL, 
    unload_person NVARCHAR(MAX) NOT NULL,
    CONSTRAINT FK_asn_asnmaster FOREIGN KEY (asnmaster_id) REFERENCES asnmaster(id) ON DELETE CASCADE
);

-- Step 2: Copy data from the old table to the new table
INSERT INTO [dbo].[new_asn] (asn_no, asn_status, spu_id, sku_id, asn_qty, actual_qty, sorted_qty, shortage_qty, more_qty, damage_qty, weight, volume, supplier_id, supplier_name, goods_owner_id, goods_owner_name, creator, create_time, last_update_time, is_valid, tenant_id, asnmaster_id, arrival_time, unload_time, unload_person_id, unload_person)
SELECT asn_no, asn_status, spu_id, sku_id, asn_qty, actual_qty, sorted_qty, shortage_qty, more_qty, damage_qty, weight, volume, supplier_id, supplier_name, goods_owner_id, goods_owner_name, creator, create_time, last_update_time, is_valid, tenant_id, asnmaster_id, arrival_time, unload_time, unload_person_id, unload_person
FROM [dbo].[asn];

-- Step 3: Drop the old table
DROP TABLE [dbo].[asn];

-- Step 4: Rename the new table to match the old table's name
EXEC sp_rename '[dbo].[new_asn]', 'asn';