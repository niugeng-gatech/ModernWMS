CREATE TABLE [dbo].[new_stocktaking] (
 id INT IDENTITY(1,1) PRIMARY KEY,
     job_code NVARCHAR(MAX) NOT NULL,
    job_status bit NOT NULL,
    sku_id int NOT NULL,
    goods_owner_id int NOT NULL,
    goods_location_id int NOT NULL,
    book_qty int NOT NULL,
    counted_qty int NOT NULL,
    difference_qty int NOT NULL,
    creator NVARCHAR(MAX) NOT NULL,
    create_time datetime2 DEFAULT GETDATE(),
    last_update_time datetime2 DEFAULT GETDATE(),
    tenant_id bigint NOT NULL,
    handler NVARCHAR(MAX) NOT NULL,
    handle_time datetime2 DEFAULT GETDATE(),
 CONSTRAINT FK_stocktaking_sku FOREIGN KEY (sku_id) REFERENCES sku (id) ON DELETE CASCADE,
 CONSTRAINT FK_stocktaking_goods_owner FOREIGN KEY (goods_owner_id) REFERENCES goodsowner (id),
 CONSTRAINT FK_stocktaking_goods_location FOREIGN KEY (goods_location_id) REFERENCES goodslocation (id)
);

-- Step 2: Copy data from the old table to the new table
INSERT INTO [dbo].[new_stocktaking] (job_code, job_status, sku_id, goods_owner_id, goods_location_id, book_qty, counted_qty, difference_qty, creator, create_time, last_update_time, tenant_id, handler, handle_time)
SELECT job_code, job_status, sku_id, goods_owner_id, goods_location_id, book_qty, counted_qty, difference_qty, creator, create_time, last_update_time, tenant_id, handler, handle_time
FROM [dbo].[stocktaking];

-- Step 3: Drop the old table
DROP TABLE [dbo].[stocktaking];

-- Step 4: Rename the new table to match the old table's name
EXEC sp_rename '[dbo].[new_stocktaking]', 'stocktaking';



sqlite> .schema stocktaking

    job_code NVARCHAR(MAX) NOT NULL,
    job_status int NOT NULL,
    sku_id int NOT NULL,
    goods_owner_id int NOT NULL,
    goods_location_id int NOT NULL,
    book_qty int NOT NULL,
    counted_qty int NOT NULL,
    difference_qty int NOT NULL,
    creator NVARCHAR(MAX) NOT NULL,
    create_time NVARCHAR(MAX) NOT NULL,
    last_update_time NVARCHAR(MAX) NOT NULL,
    tenant_id int NOT NULL,
    handler NVARCHAR(MAX) NOT NULL,
    handle_time NVARCHAR(MAX) NOT NULL