CREATE TABLE [dbo].[new_stockprocessdetail] (
 id INT IDENTITY(1,1) PRIMARY KEY,
 stock_process_id int NOT NULL,
    sku_id int NOT NULL,
    goods_owner_id int NOT NULL,
    goods_location_id int NOT NULL,
    qty int NOT NULL,
    last_update_time datetime2 DEFAULT GETDATE(),
    tenant_id bigint NOT NULL,
    is_source bit NOT NULL,
    is_update_stock bit NOT NULL, 
 series_number NVARCHAR(MAX) NOT NULL,
 CONSTRAINT FK_stockprocessdetail_stockprocess FOREIGN KEY (stock_process_id) REFERENCES stockprocess (id) ON DELETE CASCADE,
 CONSTRAINT FK_stockprocessdetail_goods_owner FOREIGN KEY (goods_owner_id) REFERENCES goodsowner (id),
 CONSTRAINT FK_stockprocessdetail_goods_location FOREIGN KEY (goods_location_id) REFERENCES goodslocation (id)
);

-- Step 2: Copy data from the old table to the new table
INSERT INTO [dbo].[new_stockprocessdetail] (stock_process_id, sku_id, goods_owner_id, goods_location_id, qty, last_update_time, tenant_id, is_source, is_update_stock, series_number)
SELECT stock_process_id, sku_id, goods_owner_id, goods_location_id, qty, last_update_time, tenant_id, is_source, is_update_stock, series_number
FROM [dbo].[stockprocessdetail];

-- Step 3: Drop the old table
DROP TABLE [dbo].[stockprocessdetail];

-- Step 4: Rename the new table to match the old table's name
EXEC sp_rename '[dbo].[new_stockprocessdetail]', 'stockprocessdetail';



sqlite> .schema stockprocessdetail

    stock_process_id int NOT NULL,
    sku_id int NOT NULL,
    goods_owner_id int NOT NULL,
    goods_location_id int NOT NULL,
    qty int NOT NULL,
    last_update_time NVARCHAR(MAX) NOT NULL,
    tenant_id int NOT NULL,
    is_source int NOT NULL,
    is_update_stock int NOT NULL, 
 series_number NVARCHAR(MAX),
    CONSTRAINT FK_stockprocessdetail_stockprocess_stock_process_id FOREIGN KEY (stock_process_id) REFERENCES stockprocess (id) ON DELETE CASCADE